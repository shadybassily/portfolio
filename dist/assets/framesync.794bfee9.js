const w=16.666666666666668,T=typeof performance<"u"?()=>performance.now():()=>Date.now(),R=typeof window<"u"?e=>window.requestAnimationFrame(e):e=>setTimeout(()=>e(T()),w);function N(e){let t=[],n=[],a=0,o=!1,u=!1;const p=new WeakSet,m={schedule:(s,r=!1,c=!1)=>{const g=c&&o,F=g?t:n;return r&&p.add(s),F.indexOf(s)===-1&&(F.push(s),g&&o&&(a=t.length)),s},cancel:s=>{const r=n.indexOf(s);r!==-1&&n.splice(r,1),p.delete(s)},process:s=>{if(o){u=!0;return}if(o=!0,[t,n]=[n,t],n.length=0,a=t.length,a)for(let r=0;r<a;r++){const c=t[r];c(s),p.has(c)&&(m.schedule(c),e())}o=!1,u&&(u=!1,m.process(s))}};return m}const E=40;let h=!0,l=!1,x=!1;const f={delta:0,timestamp:0},i=["read","update","preRender","render","postRender"],d=i.reduce((e,t)=>(e[t]=N(()=>l=!0),e),{}),A=i.reduce((e,t)=>{const n=d[t];return e[t]=(a,o=!1,u=!1)=>(l||y(),n.schedule(a,o,u)),e},{}),C=i.reduce((e,t)=>(e[t]=d[t].cancel,e),{}),D=i.reduce((e,t)=>(e[t]=()=>d[t].process(f),e),{}),O=e=>d[e].process(f),S=e=>{l=!1,f.delta=h?w:Math.max(Math.min(e-f.timestamp,E),1),f.timestamp=e,x=!0,i.forEach(O),x=!1,l&&(h=!1,R(S))},y=()=>{l=!0,h=!0,x||R(S)},M=()=>f;export{C as c,D as f,M as g,A as s};
